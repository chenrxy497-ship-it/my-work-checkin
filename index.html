<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“å¡ç³»çµ±</title>
    <style>
        /* ç°¡å–®å¥½çœ‹çš„ä»‹é¢è¨­å®š */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            padding: 20px; 
            background-color: #f0f2f5; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            width: 100%; 
            max-width: 350px; 
            text-align: center; 
        }
        h1 { margin-bottom: 10px; color: #333; }
        .time-display { font-size: 2.5em; font-weight: bold; color: #2c3e50; margin: 10px 0; }
        .status-text { margin-bottom: 20px; font-weight: bold; color: #666; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        button { 
            width: 100%; 
            padding: 15px; 
            margin: 8px 0; 
            border: none; 
            border-radius: 10px; 
            font-size: 18px; 
            font-weight: bold;
            cursor: pointer; 
            transition: transform 0.1s, opacity 0.2s; 
        }
        button:active { transform: scale(0.98); }
        
        .btn-start { background-color: #34C759; color: white; } /* ç¶ è‰² */
        .btn-counsel { background-color: #FF9500; color: white; } /* æ©˜è‰² */
        .btn-end { background-color: #FF3B30; color: white; }    /* ç´…è‰² */
        
        /* æŒ‰éˆ•å¤±æ•ˆæ™‚çš„æ¨£å­ */
        .btn-disabled { 
            background-color: #E5E5EA; 
            color: #C7C7CC; 
            cursor: not-allowed; 
            pointer-events: none;
        }

        #loading { display: none; margin-top: 10px; color: #007AFF; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ’¼ å·¥ä½œæ‰“å¡</h1>
        <div id="current-time" class="time-display">00:00:00</div>
        <div id="status" class="status-text">ç‹€æ…‹ï¼šå°šæœªä¸Šç­</div>
        
        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

        <button id="btn-start" class="btn-start" onclick="sendData('start_work')">ä¸Šç­ (è¡Œæ”¿é–‹å§‹)</button>
        <button id="btn-counsel" class="btn-counsel btn-disabled" onclick="sendData('start_counseling')" disabled>é–‹å§‹è¼”å°</button>
        <button id="btn-end" class="btn-end btn-disabled" onclick="sendData('end_work')" disabled>ä¸‹ç­ / çµæŸ</button>

        <p id="loading">â³ è³‡æ–™å‚³é€ä¸­...</p>
    </div>

    <script>
        // â˜…â˜…â˜… è«‹åœ¨é€™è£¡å¡«å…¥ä½ çš„ Google Apps Script ç¶²å€ â˜…â˜…â˜…
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz8UCARJHfzpBEuhl1sriV76H-077eFMt8rK2lhgJ1aImtozf84SqIpuxZmla5Sq2NPqg/exec";
        // é¡¯ç¤ºç›®å‰æ™‚é–“
        setInterval(() => {
            const now = new Date();
            document.getElementById('current-time').innerText = now.toLocaleTimeString('en-GB', {hour12: false});
        }, 1000);

        // è®€å–ä¸Šæ¬¡çš„ç‹€æ…‹ (é¿å…é‡æ–°æ•´ç†å¾Œç‹€æ…‹ä¸è¦‹)
        let currentState = localStorage.getItem('workState') || 'idle'; 
        updateUI(currentState);

        function updateUI(state) {
            const btnStart = document.getElementById('btn-start');
            const btnCounsel = document.getElementById('btn-counsel');
            const btnEnd = document.getElementById('btn-end');
            const statusText = document.getElementById('status');

            // é‡ç½®æŒ‰éˆ•æ¨£å¼
            btnStart.className = 'btn-start';
            btnCounsel.className = 'btn-counsel';
            btnEnd.className = 'btn-end';
            
            btnStart.disabled = false;
            btnCounsel.disabled = false;
            btnEnd.disabled = false;

            if (state === 'idle') {
                // é–’ç½®ç‹€æ…‹ï¼šåªèƒ½æŒ‰ã€Œä¸Šç­ã€
                btnCounsel.classList.add('btn-disabled'); btnCounsel.disabled = true;
                btnEnd.classList.add('btn-disabled'); btnEnd.disabled = true;
                statusText.innerText = "ç‹€æ…‹ï¼šå°šæœªä¸Šç­";
                statusText.style.color = "#666";
            } else if (state === 'working_admin') {
                // è¡Œæ”¿å·¥ä½œä¸­ï¼šä¸èƒ½å†æŒ‰ã€Œä¸Šç­ã€ï¼Œå¯ä»¥æŒ‰ã€Œè¼”å°ã€æˆ–ã€Œä¸‹ç­ã€
                btnStart.classList.add('btn-disabled'); btnStart.disabled = true;
                statusText.innerText = "ğŸŸ¢ ç‹€æ…‹ï¼šè¡Œæ”¿å·¥ä½œä¸­";
                statusText.style.color = "#34C759";
            } else if (state === 'working_counsel') {
                // è¼”å°ä¸­ï¼šä¸èƒ½æŒ‰ã€Œä¸Šç­ã€å’Œã€Œè¼”å°ã€ï¼Œåªèƒ½æŒ‰ã€Œä¸‹ç­ã€
                btnStart.classList.add('btn-disabled'); btnStart.disabled = true;
                btnCounsel.classList.add('btn-disabled'); btnCounsel.disabled = true;
                statusText.innerText = "ğŸŸ  ç‹€æ…‹ï¼šè¼”å°é€²è¡Œä¸­";
                statusText.style.color = "#FF9500";
            }
        }

        function sendData(action) {
            // ç°¡å–®é˜²å‘†ç¢ºèª
            let msg = "";
            if(action === 'start_work') msg = "ç¢ºå®šè¦æ‰“å¡ä¸Šç­å—ï¼Ÿ";
            if(action === 'start_counseling') msg = "ç¢ºå®šè¦é–‹å§‹è¨˜éŒ„è¼”å°æ™‚é–“å—ï¼Ÿ";
            if(action === 'end_work') msg = "ç¢ºå®šè¦ä¸‹ç­äº†å—ï¼Ÿ";
            
            if(!confirm(msg)) return;

            // é¡¯ç¤ºè¼‰å…¥ä¸­
            document.getElementById('loading').style.display = 'block';
            
            // å‚³é€è³‡æ–™åˆ° Google Sheet
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: new URLSearchParams({ 'action': action })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                
                if(data.result === 'success') {
                    alert(data.msg);
                    // æ›´æ–°ç‹€æ…‹
                    if(action === 'start_work') currentState = 'working_admin';
                    else if (action === 'start_counseling') currentState = 'working_counsel';
                    else if (action === 'end_work') currentState = 'idle';
                    
                    localStorage.setItem('workState', currentState);
                    updateUI(currentState);
                } else {
                    alert(data.msg); // é¡¯ç¤ºå¾Œç«¯å›å‚³çš„éŒ¯èª¤è¨Šæ¯
                }
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                alert("é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯");
                console.error(error);
            });
        }
    </script>
</body>
</html>
